[(#AUTORISER{voir,message,#ID_MESSAGE}|sinon_interdire_acces)]
[(#SET{url_voir,#VAL{message}|objet_info{url_voir}})]
[(#SET{url_edit,#VAL{message}|objet_info{url_edit}})]
<BOUCLE_message(MP_MESSAGES){id_message}{statut==.*}{si #ENV{exec}|=={#GET{url_voir}}}>
[(#BOITE_OUVRIR{[
	[(#AUTORISER{modifier,message,#ID_MESSAGE})
		[(#ID_MESSAGE|afficher_qui_edite{message}|non)
			[(#URL_ECRIRE{#GET{url_edit},id_message=#ID_MESSAGE}|icone_verticale{<:message:icone_modifier_message:>,message,edit,right ajax preload})]
		]
		[(#ID_MESSAGE|afficher_qui_edite{message}|oui)
			[(#URL_ECRIRE{#GET{url_edit},id_message=#ID_MESSAGE}|icone_verticale{#ID_MESSAGE|afficher_qui_edite{message},warning-24,'',right edition_deja ajax preload})]
		]
	]

	<h1>[(#RANG). ](#TITRE|sinon{<:info_sans_titre:>})[(#CHEMIN_IMAGE{message-24.png}|balise_img{message,cadre-icone})]</h1>

],simple fiche_objet})]

<div class="ajax">
	#FORMULAIRE_DATER{message,#ID_MESSAGE}
</div>

<!--affiche_milieu-->

<div id="wysiwyg">
<INCLURE{fond=prive/objets/contenu/message,id=#ID_MESSAGE,id_message=#ID_MESSAGE,virtuel=oui,ajax=wysiwyg,wysiwyg=1}>
</div>

<div class="nettoyeur"></div>

[(#AUTORISER{modifier,message,#ID_MESSAGE})
	[(#ID_MESSAGE|afficher_qui_edite{message}|non)
		[(#URL_ECRIRE{#GET{url_edit},id_message=#ID_MESSAGE}|icone_verticale{<:message:icone_modifier_message:>,message,edit,right ajax preload})]
	]
	[(#ID_MESSAGE|afficher_qui_edite{message}|oui)
		[(#URL_ECRIRE{#GET{url_edit},id_message=#ID_MESSAGE}|icone_verticale{#ID_MESSAGE|afficher_qui_edite{message},warning-24,'',right edition_deja ajax preload})]
	]
]

<div class="nettoyeur"></div>
<div class="liste">
	<BOUCLE_objetslies(spip_mp_messages_liens){id_message}{0,1}><h3><:message:titre_objets_lies_message:></h3></BOUCLE_objetslies>

	<BOUCLE_listeobjets(spip_mp_messages_liens){id_message}{fusion objet}{par objet}>
		#SET{table,#OBJET|table_objet}
		[(#SET{titre,[#OBJET:info_(#GET{table})_liees_message]})]
		[(#SET{liste,#VAL{prive/objets/liste/#GET{table}}|trouver_fond|?{#GET{table},objets_lies_message}})]
		<INCLURE{fond=prive/objets/liste/#GET{liste},objet,id_message,ajax,env} />
	</BOUCLE_listeobjets>
</div>

#PIPELINE{afficher_complement_objet,#ARRAY{args,#ARRAY{type,message,id,#ID_MESSAGE},data,'<div class="nettoyeur"></div>'}}

#BOITE_FERMER


#SET{enfants,''}
[(#VAL{prive/objets/contenu/message-enfants}|trouver_fond|oui)
	[(#SET{enfants,[(#INCLURE{fond=prive/objets/contenu/message-enfants,id_message,env})]})]
]
[(#PIPELINE{affiche_enfants,[(#ARRAY{args,#ARRAY{exec,message,id_message,#ID_MESSAGE,objet,message,id_objet,#ID_MESSAGE},data,#GET{enfants}})]})]

[(#EVAL{_AJAX}|oui)
	<script type="text/javascript">/*<!\\[CDATA\\[*/reloadExecPage('#ENV{exec}','#navigation,#chemin,#extra');/*\\]\\]>*/</script>
]
</BOUCLE_message>
[(#ENV**{exec}|=={#GET{url_edit}}|?{#INCLURE{fond=prive/squelettes/contenu/#GET{url_edit},redirect='',env,retourajax=oui},#REM|sinon_interdire_acces})]
<//B_message>
